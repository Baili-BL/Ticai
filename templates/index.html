<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aè‚¡çƒ­é—¨é¢˜ææ¨è</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif; 
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); 
            min-height: 100vh;
            padding: 20px; 
            color: #fff;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 { 
            text-align: center; 
            margin-bottom: 10px; 
            font-size: 28px;
            background: linear-gradient(90deg, #00d4ff, #7b2cbf);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .subtitle { text-align: center; color: #888; margin-bottom: 20px; font-size: 14px; }
        .loading { text-align: center; padding: 60px; color: #888; font-size: 18px; }
        .loading::after {
            content: '';
            animation: dots 1.5s infinite;
        }
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
        .themes { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); 
            gap: 20px; 
        }
        .theme-card { 
            background: rgba(255,255,255,0.05); 
            border-radius: 12px; 
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .theme-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
        }
        .theme-header { 
            background: linear-gradient(135deg, rgba(123,44,191,0.8), rgba(0,212,255,0.6));
            padding: 15px 18px; 
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .theme-name { font-size: 18px; font-weight: 600; }
        .theme-stats { font-size: 13px; opacity: 0.9; }
        .theme-change { 
            font-size: 20px; 
            font-weight: bold;
            padding: 4px 10px;
            border-radius: 6px;
            background: rgba(0,0,0,0.2);
        }
        .stock-list { padding: 12px; }
        .stock-item { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 14px 12px; 
            border-radius: 8px;
            margin-bottom: 8px;
            background: rgba(255,255,255,0.03);
            transition: background 0.2s;
        }
        .stock-item:hover { background: rgba(255,255,255,0.08); }
        .stock-item:last-child { margin-bottom: 0; }
        .stock-info { flex: 1; }
        .stock-name { font-weight: 600; color: #fff; font-size: 15px; }
        .stock-code { color: #888; font-size: 12px; margin-left: 8px; }
        .stock-meta { font-size: 12px; color: #666; margin-top: 6px; }
        .stock-meta span { margin-right: 12px; }
        .stock-price { text-align: right; min-width: 90px; }
        .price-value { font-size: 20px; font-weight: bold; }
        .price-change { font-size: 14px; margin-top: 2px; }
        .up { color: #ff4757; }
        .down { color: #2ed573; }
        .score-badge { 
            display: inline-block;
            background: rgba(0,212,255,0.2); 
            color: #00d4ff;
            padding: 3px 8px; 
            border-radius: 4px; 
            font-size: 11px; 
        }
        .signal-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 6px;
        }
        .signal-text {
            font-size: 12px;
            color: #ffa502;
        }
        .tag { 
            display: inline-block;
            padding: 2px 6px; 
            border-radius: 3px; 
            font-size: 10px;
            margin-left: 6px;
            vertical-align: middle;
        }
        .tag-special {
            background: rgba(255,71,87,0.3);
            color: #ff4757;
            font-weight: bold;
        }
        .strength-tag {
            font-size: 11px;
            color: #888;
            margin-top: 4px;
        }
        .reason { font-size: 11px; color: #888; margin-top: 4px; }
        .toolbar {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        .refresh-btn { 
            padding: 12px 35px; 
            background: linear-gradient(135deg, #7b2cbf, #00d4ff);
            color: #fff; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 15px;
            font-weight: 500;
            transition: opacity 0.2s, transform 0.2s;
        }
        .refresh-btn:hover { opacity: 0.9; transform: scale(1.02); }
        .refresh-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .error { 
            color: #ff4757; 
            padding: 20px; 
            text-align: center; 
            background: rgba(255,71,87,0.1);
            border-radius: 8px;
        }
        .update-time { 
            text-align: center; 
            color: #666; 
            font-size: 12px; 
            margin-top: 15px; 
        }
        .empty-stock { color: #666; padding: 20px; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ˆ Aè‚¡çƒ­é—¨é¢˜ææ¨è</h1>
        <p class="subtitle">å®æ—¶è¿½è¸ªå¸‚åœºçƒ­ç‚¹ï¼Œæ¯ä¸ªé¢˜æç²¾é€‰2-3åªé¢†æ¶¨è‚¡</p>
        <div class="toolbar">
            <button class="refresh-btn" onclick="loadData()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
        </div>
        <div id="content" class="loading">æ­£åœ¨è·å–å®æ—¶æ•°æ®</div>
        <div class="update-time" id="updateTime"></div>
    </div>
    <script>
        async function loadData() {
            const content = document.getElementById('content');
            const btn = document.querySelector('.refresh-btn');
            const timeEl = document.getElementById('updateTime');
            
            content.innerHTML = '<div class="loading">æ­£åœ¨å¹¶å‘è·å–æ•°æ®</div>';
            btn.disabled = true;
            btn.textContent = 'â³ åŠ è½½ä¸­...';
            
            const startTime = Date.now();
            
            try {
                const res = await fetch('/api/all');
                const json = await res.json();
                
                if (!json.success) {
                    throw new Error(json.error || 'è·å–æ•°æ®å¤±è´¥');
                }
                
                const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
                renderData(json.data);
                timeEl.textContent = `æ›´æ–°æ—¶é—´: ${new Date().toLocaleString()} | è€—æ—¶: ${elapsed}ç§’`;
            } catch (e) {
                content.innerHTML = `<div class="error">âŒ ${e.message}</div>`;
            } finally {
                btn.disabled = false;
                btn.textContent = 'ğŸ”„ åˆ·æ–°æ•°æ®';
            }
        }
        
        function renderData(data) {
            const content = document.getElementById('content');
            
            if (!data || Object.keys(data).length === 0) {
                content.innerHTML = '<div class="error">æš‚æ— æ•°æ®ï¼Œè¯·ç¨åé‡è¯•</div>';
                return;
            }
            
            let html = '<div class="themes">';
            
            for (const [theme, themeData] of Object.entries(data)) {
                const info = themeData.info || {};
                const stocks = themeData.stocks || [];
                const themeChange = info.change_pct || 0;
                const changeClass = themeChange >= 0 ? 'up' : 'down';
                
                html += `<div class="theme-card">
                    <div class="theme-header">
                        <div>
                            <div class="theme-name">ğŸ·ï¸ ${theme}</div>
                            <div class="theme-stats">â†‘${info.up_count || 0} â†“${info.down_count || 0}</div>
                        </div>
                        <div class="theme-change ${changeClass}">${themeChange >= 0 ? '+' : ''}${themeChange.toFixed(2)}%</div>
                    </div>
                    <div class="stock-list">`;
                
                if (stocks.length === 0) {
                    html += '<div class="empty-stock">æš‚æ— æ¨èè‚¡ç¥¨</div>';
                } else {
                    for (const stock of stocks) {
                        if (stock.error) {
                            html += `<div class="stock-item">
                                <div class="stock-info">
                                    <span class="stock-name">${stock.name || stock.code}</span>
                                    <div class="reason">${stock.error}</div>
                                </div>
                            </div>`;
                            continue;
                        }
                        
                        const changeNum = stock.change_pct_num || 0;
                        const colorClass = changeNum >= 0 ? 'up' : 'down';
                        const weakToStrong = stock.is_weak_to_strong ? '<span class="tag tag-special">å¼±è½¬å¼º</span>' : '';
                        
                        html += `<div class="stock-item">
                            <div class="stock-info">
                                <span class="stock-name">${stock.name}</span>
                                <span class="stock-code">${stock.code}</span>
                                ${weakToStrong}
                                <div class="stock-meta">
                                    <span>é‡èƒ½ <b>${stock.volume_level}</b></span>
                                    <span>æˆäº¤ ${stock.amount}</span>
                                    <span>æŒ¯å¹… ${stock.amplitude}</span>
                                </div>
                                <div class="signal-row">
                                    <span class="score-badge">è¯„åˆ† ${stock.score}</span>
                                    <span class="signal-text">${stock.signal}</span>
                                </div>
                                <div class="reason">${stock.reason}</div>
                            </div>
                            <div class="stock-price">
                                <div class="price-value ${colorClass}">${stock.price}</div>
                                <div class="price-change ${colorClass}">${stock.change_pct}</div>
                                <div class="strength-tag">${stock.strength}</div>
                            </div>
                        </div>`;
                    }
                }
                
                html += '</div></div>';
            }
            
            html += '</div>';
            content.innerHTML = html;
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è·å–æ•°æ®
        loadData();
    </script>
</body>
</html>
