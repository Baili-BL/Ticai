<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A股热门题材推荐</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); min-height: 100vh; padding: 20px; color: #fff; }
        .container { max-width: 100%; margin: 0 auto; padding: 0 15px; }
        .header-row { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; }
        .header-left { flex: 1; }
        .header-right { display: flex; align-items: center; gap: 15px; }
        .update-time-top { color: #888; font-size: 13px; }
        h1 { text-align: left; margin-bottom: 10px; font-size: 28px; background: linear-gradient(90deg, #00d4ff, #7b2cbf); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; }
        .subtitle { text-align: left; color: #888; font-size: 14px; }
        .loading { text-align: center; padding: 60px; color: #888; font-size: 18px; }
        .themes { display: grid; grid-template-columns: repeat(4, minmax(0, 1fr)); gap: 10px; width: 100%; }
        .theme-card { background: rgba(255,255,255,0.05); border-radius: 12px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); }
        .theme-header { background: linear-gradient(135deg, rgba(123,44,191,0.8), rgba(0,212,255,0.6)); padding: 15px 18px; display: flex; justify-content: space-between; align-items: center; }
        .theme-name { font-size: 18px; font-weight: 600; display: flex; align-items: center; flex-wrap: wrap; gap: 6px; }
        .theme-stats { font-size: 13px; opacity: 0.9; margin-top: 4px; }
        .theme-change { font-size: 20px; font-weight: bold; padding: 4px 10px; border-radius: 6px; background: rgba(0,0,0,0.2); }
        .emotion-label { display: inline-block; padding: 3px 10px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .stock-list { padding: 12px; }
        .stock-item { display: flex; justify-content: space-between; align-items: center; padding: 14px 12px; border-radius: 8px; margin-bottom: 8px; background: rgba(255,255,255,0.03); }
        .stock-item:last-child { margin-bottom: 0; }
        .stock-info { flex: 1; }
        .stock-name { font-weight: 600; color: #fff; font-size: 15px; }
        .stock-code { color: #888; font-size: 12px; margin-left: 8px; }
        .stock-meta { font-size: 12px; color: #666; margin-top: 6px; }
        .stock-meta span { margin-right: 12px; }
        .stock-price { text-align: right; min-width: 90px; }
        .price-value { font-size: 20px; font-weight: bold; }
        .price-change { font-size: 14px; margin-top: 2px; }
        .up { color: #ff4757; }
        .down { color: #2ed573; }
        .score-badge { display: inline-block; background: rgba(0,212,255,0.2); color: #00d4ff; padding: 3px 8px; border-radius: 4px; font-size: 11px; }
        .signal-row { display: flex; align-items: center; gap: 10px; margin-top: 6px; }
        .signal-text { font-size: 12px; color: #ffa502; }
        .tag { display: inline-block; padding: 2px 6px; border-radius: 3px; font-size: 10px; margin-left: 6px; }
        .tag-special { background: rgba(255,71,87,0.3); color: #ff4757; font-weight: bold; }
        .tag-leader { background: linear-gradient(135deg, #ff4757, #ff6b81); color: #fff; font-weight: bold; }
        .tag-auction { background: rgba(155,89,182,0.3); color: #9b59b6; font-weight: bold; }
        .tag-auction-good { background: rgba(46,213,115,0.2); color: #2ed573; }
        .tag-front { background: linear-gradient(135deg, #f39c12, #e74c3c); color: #fff; font-weight: bold; }
        .role-tag { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; margin-right: 6px; }
        .role-leader { background: linear-gradient(135deg, #ff4757, #ff6b81); color: #fff; }
        .role-middle { background: linear-gradient(135deg, #3498db, #2980b9); color: #fff; }
        .role-dip { background: linear-gradient(135deg, #2ed573, #26de81); color: #fff; }
        .role-follow { background: rgba(149,165,166,0.3); color: #95a5a6; }
        .stock-tags { display: flex; flex-wrap: wrap; gap: 4px; margin-top: 4px; }
        .buy-tag { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; margin-left: 8px; }
        .strong-buy { background: linear-gradient(135deg, #ff4757, #ff6b81); color: #fff; }
        .can-buy { background: rgba(46,213,115,0.2); color: #2ed573; border: 1px solid #2ed573; }
        .watch { background: rgba(255,165,2,0.15); color: #ffa502; }
        .highlight-stock { background: rgba(255,71,87,0.08) !important; border-left: 3px solid #ff4757; }
        .strength-tag { font-size: 11px; color: #888; margin-top: 4px; }
        .reason { font-size: 11px; color: #888; margin-top: 4px; }
        .emotion-row { display: flex; align-items: center; gap: 6px; margin-top: 4px; font-size: 11px; color: #aaa; }
        .refresh-btn { padding: 10px 25px; background: linear-gradient(135deg, #7b2cbf, #00d4ff); color: #fff; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; }
        .refresh-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .quality-tags { display: flex; gap: 4px; margin-top: 4px; flex-wrap: wrap; }
        .quality-tag { display: inline-block; padding: 2px 6px; border-radius: 3px; font-size: 10px; font-weight: bold; }
        .quality-big { background: rgba(255,193,7,0.2); color: #ffc107; }
        .quality-new { background: rgba(0,212,255,0.2); color: #00d4ff; }
        .quality-strong { background: rgba(255,71,87,0.2); color: #ff4757; }
        .news-tag { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: bold; margin-left: 6px; }
        .news-positive { background: rgba(46,213,115,0.2); color: #2ed573; }
        .news-negative { background: rgba(255,71,87,0.2); color: #ff4757; }
        .news-neutral { background: rgba(149,165,166,0.2); color: #95a5a6; }
        .error { color: #ff4757; padding: 20px; text-align: center; background: rgba(255,71,87,0.1); border-radius: 8px; }
        .empty-stock { color: #666; padding: 20px; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-row">
            <div class="header-left">
                <h1>A股热门题材推荐</h1>
                <p class="subtitle">实时追踪市场热点，每个题材精选3-5只股票（龙头+中军+低吸）</p>
            </div>
            <div class="header-right">
                <span class="update-time-top" id="updateTime"></span>
                <button class="refresh-btn" onclick="loadData()">刷新数据</button>
            </div>
        </div>
        <div id="content" class="loading">正在获取实时数据...</div>
    </div>
    <script>
        async function loadData() {
            const content = document.getElementById('content');
            const btn = document.querySelector('.refresh-btn');
            const timeEl = document.getElementById('updateTime');
            content.innerHTML = '<div class="loading">正在获取数据...</div>';
            btn.disabled = true;
            btn.textContent = '加载中...';
            try {
                const res = await fetch('/api/all?t=' + Date.now());
                const json = await res.json();
                if (!json.success) throw new Error(json.error || '获取失败');
                renderData(json.data);
                timeEl.textContent = '更新: ' + new Date().toLocaleString();
            } catch (e) {
                content.innerHTML = '<div class="error">' + e.message + '</div>';
            } finally {
                btn.disabled = false;
                btn.textContent = '刷新数据';
            }
        }
        function renderData(data) {
            const content = document.getElementById('content');
            if (!data || Object.keys(data).length === 0) { content.innerHTML = '<div class="error">暂无数据</div>'; return; }
            let html = '<div class="themes">';
            for (const [theme, td] of Object.entries(data)) {
                const info = td.info || {}, stocks = td.stocks || [], emotion = td.emotion || {}, quality = td.quality || {}, news = td.news || {};
                const hotScore = td.hot_score || 0, themeChange = info.change_pct || 0;
                const changeClass = themeChange >= 0 ? 'up' : 'down';
                const emotionStage = emotion.stage || '', emotionColor = emotion.color || '#6c757d', emotionAdvice = emotion.advice || '';
                const emotionLabel = emotionStage ? '<span class="emotion-label" style="background:'+emotionColor+'33;color:'+emotionColor+';border:1px solid '+emotionColor+'">'+emotionStage+'</span>' : '';
                let newsLabel = '';
                if (news.level === '利好') newsLabel = '<span class="news-tag news-positive">利好'+(news.positive_news>0?'('+news.positive_news+')':'')+'</span>';
                else if (news.level === '利空') newsLabel = '<span class="news-tag news-negative">利空'+(news.negative_news>0?'('+news.negative_news+')':'')+'</span>';
                else if (news.news_count > 0) newsLabel = '<span class="news-tag news-neutral">'+news.news_count+'条</span>';
                let qualityTags = '';
                if (quality.tags && quality.tags.length > 0) {
                    qualityTags = '<div class="quality-tags">';
                    for (const tag of quality.tags) {
                        const tn = tag.name || tag, td2 = tag.desc || '';
                        let tc = tn.includes('大')?'quality-big':tn.includes('新')?'quality-new':tn.includes('强')?'quality-strong':'';
                        qualityTags += '<span class="quality-tag '+tc+'" title="'+td2+'">'+tn+'</span>';
                    }
                    qualityTags += '</div>';
                }
                html += '<div class="theme-card"><div class="theme-header"><div><div class="theme-name">'+theme+' '+emotionLabel+' '+newsLabel+'</div>';
                html += '<div class="theme-stats">上涨'+(info.up_count||0)+' 下跌'+(info.down_count||0)+' | 热度 '+hotScore.toFixed(0)+'</div>'+qualityTags;
                html += (emotionAdvice?'<div class="emotion-row">'+emotionAdvice+'</div>':'')+'</div>';
                html += '<div class="theme-change '+changeClass+'">'+(themeChange>=0?'+':'')+themeChange.toFixed(2)+'%</div></div><div class="stock-list">';
                if (stocks.length === 0) { html += '<div class="empty-stock">暂无推荐股票</div>'; }
                else {
                    for (const s of stocks) {
                        if (s.error) { html += '<div class="stock-item"><div class="stock-info"><span class="stock-name">'+(s.name||s.code)+'</span><div class="reason">'+s.error+'</div></div></div>'; continue; }
                        const cn = s.change_pct_num||0, cc = cn>=0?'up':'down';
                        let tags = [];
                        if (s.is_first_limit) tags.push('<span class="tag tag-leader">率先涨停</span>');
                        if (s.is_front_runner && s.front_runner_tags && s.front_runner_tags.length>0) tags.push('<span class="tag tag-front">'+s.front_runner_tags[0]+'</span>');
                        if (s.open_strength==='竞价涨停'||s.open_strength==='竞价强势') tags.push('<span class="tag tag-auction">'+s.open_strength+'</span>');
                        else if (s.open_strength==='高开强势') tags.push('<span class="tag tag-auction-good">高开强势</span>');
                        if (s.is_weak_to_strong) tags.push('<span class="tag tag-special">弱转强'+(s.weak_to_strong_type?'-'+s.weak_to_strong_type:'')+'</span>');
                        const gs=['量价齐升','筹码锁定'], gst=['启动','发酵'];
                        const hgs=gs.some(x=>s.signal&&s.signal.includes(x)), igs=gst.includes(emotionStage);
                        const isb=(s.score>=90&&hgs&&igs)||s.is_first_limit||s.is_weak_to_strong, ib=s.score>=80&&hgs;
                        let bt='';
                        if(isb) bt='<span class="buy-tag strong-buy">强烈推荐</span>';
                        else if(ib) bt='<span class="buy-tag can-buy">可买入</span>';
                        else if(s.score>=70) bt='<span class="buy-tag watch">观察</span>';
                        let roleTag='';
                        if(s.role==='龙头') roleTag='<span class="role-tag role-leader">龙头</span>';
                        else if(s.role==='中军') roleTag='<span class="role-tag role-middle">中军</span>';
                        else if(s.role==='低吸') roleTag='<span class="role-tag role-dip">低吸</span>';
                        else if(s.role==='跟风') roleTag='<span class="role-tag role-follow">跟风</span>';
                        const roleReason = s.role_reason ? '<span style="color:#888;font-size:10px;margin-left:4px">'+s.role_reason+'</span>' : '';
                        html += '<div class="stock-item '+(isb?'highlight-stock':'')+'"><div class="stock-info">'+roleTag+'<span class="stock-name">'+s.name+'</span><span class="stock-code">'+s.code+'</span>'+roleReason+bt;
                        html += (tags.length?'<div class="stock-tags">'+tags.join('')+'</div>':'');
                        html += '<div class="stock-meta"><span>量能 <b>'+s.volume_level+'</b></span><span>换手 '+(s.turnover_rate||'-')+'</span><span>成交 '+s.amount+'</span></div>';
                        html += '<div class="signal-row"><span class="score-badge">评分 '+s.score+'</span><span class="signal-text">'+s.signal+'</span></div><div class="reason">'+s.reason+'</div></div>';
                        html += '<div class="stock-price"><div class="price-value '+cc+'">'+s.price+'</div><div class="price-change '+cc+'">'+s.change_pct+'</div><div class="strength-tag">'+s.strength+'</div></div></div>';
                    }
                }
                html += '</div></div>';
            }
            html += '</div>';
            content.innerHTML = html;
        }
        loadData();
    </script>
</body>
</html>