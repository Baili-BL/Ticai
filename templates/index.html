<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A股热门题材推荐</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); min-height: 100vh; padding: 8px 4px; color: #fff; }
        .container { max-width: 100%; margin: 0 auto; padding: 0 2px; }
        .header-row { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; flex-wrap: wrap; gap: 10px; }
        .header-left { flex: 1; min-width: 200px; }
        .header-right { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
        .update-time-top { color: #888; font-size: 12px; }
        h1 { text-align: left; margin-bottom: 8px; font-size: 22px; background: linear-gradient(90deg, #00d4ff, #7b2cbf); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; }
        .subtitle { text-align: left; color: #888; font-size: 13px; line-height: 1.4; }
        .loading { text-align: center; padding: 50px; color: #888; font-size: 16px; }
        .themes { display: flex; flex-direction: column; gap: 10px; width: 100%; padding: 0; }
        .themes.pc-mode { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; padding: 0; }
        .theme-card { background: rgba(255,255,255,0.05); border-radius: 8px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); width: 100%; }
        .theme-header { background: linear-gradient(135deg, rgba(123,44,191,0.8), rgba(0,212,255,0.6)); padding: 12px; display: block; position: relative; }
        .theme-header.pc-mode { display: flex; justify-content: space-between; align-items: center; position: static; }
        .theme-name { font-size: 15px; font-weight: 600; display: block; margin-bottom: 5px; padding-right: 65px; }
        .theme-name.pc-mode { padding-right: 0; }
        .theme-stats { font-size: 11px; opacity: 0.9; margin-top: 3px; }
        .theme-change { font-size: 15px; font-weight: bold; padding: 3px 8px; border-radius: 5px; background: rgba(0,0,0,0.2); position: absolute; top: 12px; right: 12px; }
        .theme-change.pc-mode { position: static; }
        .emotion-label { display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold; }
        .stock-list { padding: 10px; }
        .stock-item { display: block; padding: 10px; border-radius: 8px; margin-bottom: 8px; background: rgba(255,255,255,0.03); }
        .stock-item.pc-mode { display: flex; justify-content: space-between; align-items: center; }
        .stock-item:last-child { margin-bottom: 0; }
        .stock-info { flex: 1; margin-bottom: 8px; }
        .stock-info.pc-mode { margin-bottom: 0; }
        .stock-name { font-weight: 600; color: #fff; font-size: 14px; }
        .stock-code { color: #888; font-size: 11px; margin-left: 6px; }
        .stock-meta { font-size: 10px; color: #666; margin-top: 5px; }
        .stock-meta span { margin-right: 8px; display: inline-block; }
        .stock-price { text-align: left; display: flex; align-items: center; gap: 10px; }
        .stock-price.pc-mode { text-align: right; display: block; min-width: 85px; }
        .price-value { font-size: 16px; font-weight: bold; }
        .price-change { font-size: 12px; }
        .up { color: #ff4757; }
        .down { color: #2ed573; }
        .score-badge { display: inline-block; background: rgba(0,212,255,0.2); color: #00d4ff; padding: 2px 6px; border-radius: 4px; font-size: 10px; }
        .signal-row { display: flex; align-items: center; gap: 6px; margin-top: 5px; flex-wrap: wrap; }
        .signal-text { font-size: 10px; color: #ffa502; }
        .tag { display: inline-block; padding: 2px 5px; border-radius: 3px; font-size: 9px; margin-left: 3px; }
        .tag-special { background: rgba(255,71,87,0.3); color: #ff4757; font-weight: bold; }
        .tag-leader { background: linear-gradient(135deg, #ff4757, #ff6b81); color: #fff; font-weight: bold; }
        .role-tag { display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold; margin-right: 5px; }
        .role-leader { background: linear-gradient(135deg, #ff4757, #ff6b81); color: #fff; }
        .role-middle { background: linear-gradient(135deg, #3498db, #2980b9); color: #fff; }
        .role-dip { background: linear-gradient(135deg, #2ed573, #26de81); color: #fff; }
        .stock-tags { display: flex; flex-wrap: wrap; gap: 3px; margin-top: 3px; }
        .buy-tag { display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold; margin-left: 5px; }
        .strong-buy { background: linear-gradient(135deg, #ff4757, #ff6b81); color: #fff; }
        .can-buy { background: rgba(46,213,115,0.2); color: #2ed573; border: 1px solid #2ed573; }
        .watch { background: rgba(255,165,2,0.15); color: #ffa502; }
        .highlight-stock { background: rgba(255,71,87,0.08) !important; border-left: 3px solid #ff4757; }
        .emotion-row { display: flex; align-items: center; gap: 5px; margin-top: 3px; font-size: 10px; color: #aaa; }
        .refresh-btn { padding: 7px 14px; background: linear-gradient(135deg, #7b2cbf, #00d4ff); color: #fff; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; }
        .refresh-btn:disabled { opacity: 0.5; }
        .mode-btn { padding: 7px 10px; background: rgba(255,255,255,0.1); color: #fff; border: 1px solid rgba(255,255,255,0.3); border-radius: 5px; cursor: pointer; font-size: 11px; }
        .mode-btn.active { background: rgba(0,212,255,0.2); border-color: #00d4ff; }
        .quality-tags { display: flex; gap: 3px; margin-top: 3px; flex-wrap: wrap; }
        .quality-tag { display: inline-block; padding: 2px 5px; border-radius: 3px; font-size: 9px; font-weight: bold; }
        .quality-big { background: rgba(255,193,7,0.2); color: #ffc107; }
        .quality-new { background: rgba(0,212,255,0.2); color: #00d4ff; }
        .quality-strong { background: rgba(255,71,87,0.2); color: #ff4757; }
        .news-tag { display: inline-block; padding: 2px 5px; border-radius: 4px; font-size: 9px; font-weight: bold; margin-left: 3px; }
        .news-positive { background: rgba(46,213,115,0.2); color: #2ed573; }
        .news-negative { background: rgba(255,71,87,0.2); color: #ff4757; }
        .error { color: #ff4757; padding: 20px; text-align: center; background: rgba(255,71,87,0.1); border-radius: 8px; }
        .empty-stock { color: #666; padding: 15px; text-align: center; }
    </style>
</head><body>
    <div class="container">
        <div class="header-row">
            <div class="header-left">
                <h1>A股热门题材推荐</h1>
                <p class="subtitle">实时追踪市场热点</p>
            </div>
            <div class="header-right">
                <button class="mode-btn active" id="modeBtn" onclick="toggleMode()">移动端</button>
                <span class="update-time-top" id="updateTime"></span>
                <button class="refresh-btn" onclick="loadData()">刷新</button>
            </div>
        </div>
        <div id="content" class="loading">正在获取数据...</div>
    </div>
    <script>
        let isPcMode = false;
        function toggleMode() {
            isPcMode = !isPcMode;
            document.getElementById('modeBtn').textContent = isPcMode ? 'PC端' : '移动端';
            document.getElementById('modeBtn').classList.toggle('active', !isPcMode);
            applyMode();
        }
        function applyMode() {
            const t = document.querySelector('.themes');
            if (t) t.classList.toggle('pc-mode', isPcMode);
            document.querySelectorAll('.theme-header,.theme-name,.theme-change,.stock-item,.stock-info,.stock-price').forEach(el => el.classList.toggle('pc-mode', isPcMode));
        }
        async function loadData() {
            const content = document.getElementById('content');
            const btn = document.querySelector('.refresh-btn');
            content.innerHTML = '<div class="loading">加载中...</div>';
            btn.disabled = true;
            try {
                const res = await fetch('/api/all?t=' + Date.now());
                const json = await res.json();
                if (!json.success) throw new Error(json.error);
                renderData(json.data);
                document.getElementById('updateTime').textContent = new Date().toLocaleString();
            } catch (e) {
                content.innerHTML = '<div class="error">' + e.message + '</div>';
            } finally {
                btn.disabled = false;
            }
        }
        function renderData(data) {
            if (!data || Object.keys(data).length === 0) { document.getElementById('content').innerHTML = '<div class="error">暂无数据</div>'; return; }
            let html = '<div class="themes">';
            for (const [theme, td] of Object.entries(data)) {
                const info = td.info || {}, stocks = td.stocks || [], emotion = td.emotion || {}, quality = td.quality || {}, news = td.news || {};
                const hotScore = td.hot_score || 0, themeChange = info.change_pct || 0;
                const changeClass = themeChange >= 0 ? 'up' : 'down';
                const emotionStage = emotion.stage || '', emotionColor = emotion.color || '#6c757d', emotionAdvice = emotion.advice || '';
                const emotionLabel = emotionStage ? '<span class="emotion-label" style="background:'+emotionColor+'33;color:'+emotionColor+'">'+emotionStage+'</span>' : '';
                let newsLabel = '';
                if (news.level === '利好') newsLabel = '<span class="news-tag news-positive">利好</span>';
                else if (news.level === '利空') newsLabel = '<span class="news-tag news-negative">利空</span>';
                let qualityTags = '';
                if (quality.tags && quality.tags.length > 0) {
                    qualityTags = '<div class="quality-tags">';
                    for (const tag of quality.tags) {
                        const tn = tag.name || tag;
                        let tc = tn.includes('大')?'quality-big':tn.includes('新')?'quality-new':'quality-strong';
                        qualityTags += '<span class="quality-tag '+tc+'">'+tn+'</span>';
                    }
                    qualityTags += '</div>';
                }
                html += '<div class="theme-card"><div class="theme-header"><div><div class="theme-name">'+theme+' '+emotionLabel+newsLabel+'</div>';
                html += '<div class="theme-stats">涨'+info.up_count+' 跌'+info.down_count+' 热度'+hotScore.toFixed(0)+'</div>'+qualityTags;
                html += (emotionAdvice?'<div class="emotion-row">'+emotionAdvice+'</div>':'')+'</div>';
                html += '<div class="theme-change '+changeClass+'">'+(themeChange>=0?'+':'')+themeChange.toFixed(2)+'%</div></div><div class="stock-list">';
                if (stocks.length === 0) html += '<div class="empty-stock">暂无</div>';
                else {
                    for (const s of stocks) {
                        if (s.error) { html += '<div class="stock-item"><div class="stock-info"><span class="stock-name">'+(s.name||s.code)+'</span></div></div>'; continue; }
                        const cn = s.change_pct_num||0, cc = cn>=0?'up':'down';
                        let tags = [];
                        if (s.is_first_limit) tags.push('<span class="tag tag-leader">率先涨停</span>');
                        if (s.is_weak_to_strong) tags.push('<span class="tag tag-special">弱转强</span>');
                        let bt='';
                        if(s.score>=90) bt='<span class="buy-tag strong-buy">强烈推荐</span>';
                        else if(s.score>=80) bt='<span class="buy-tag can-buy">可买入</span>';
                        else if(s.score>=70) bt='<span class="buy-tag watch">观察</span>';
                        let roleTag='';
                        if(s.role==='龙头') roleTag='<span class="role-tag role-leader">龙头</span>';
                        else if(s.role==='中军') roleTag='<span class="role-tag role-middle">中军</span>';
                        else if(s.role==='低吸') roleTag='<span class="role-tag role-dip">低吸</span>';
                        html += '<div class="stock-item '+(s.score>=90?'highlight-stock':'')+'"><div class="stock-info">'+roleTag+'<span class="stock-name">'+s.name+'</span><span class="stock-code">'+s.code+'</span>'+bt;
                        html += (tags.length?'<div class="stock-tags">'+tags.join('')+'</div>':'');
                        html += '<div class="stock-meta"><span>量能'+s.volume_level+'</span><span>换手'+(s.turnover_rate||'-')+'</span></div>';
                        html += '<div class="signal-row"><span class="score-badge">'+s.score+'分</span><span class="signal-text">'+s.signal+'</span></div></div>';
                        html += '<div class="stock-price"><div class="price-value '+cc+'">'+s.price+'</div><div class="price-change '+cc+'">'+s.change_pct+'</div></div></div>';
                    }
                }
                html += '</div></div>';
            }
            html += '</div>';
            document.getElementById('content').innerHTML = html;
            applyMode();
        }
        loadData();
    </script>
</body>
</html>
